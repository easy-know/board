<!DOCTYPE html>
<html lang="ko"
      layout:decorate="layouts/default-layout"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org">
<!-- board-list.html 고유 스크립트 추가 -->
<th:block layout:fragment="script">
    <link rel="stylesheet" th:href="@{static/css/tui-pagination.css}">
    <link rel="stylesheet" th:href="@{static/css/tui-grid.css}">
    <script th:src="@{static/js/tui-pagination.js}" type="text/javascript"></script>
    <script th:src="@{static/js/tui-grid.js}" type="text/javascript"></script>
    <script type="text/javascript">
        $(window).on('load', () => {
            createGrid();
        })

        function createGrid() {
            const dataSource = {
                api: {
                    readData: {
                        url: '/api/board',
                        method: 'GET'
                    }
                },
                serializer(params) {
                    return Object.keys(params).map(
                        key => encodeURI('perPage' === key ? 'size' : key) + "=" + encodeURIComponent('page' === key ? params[key] : params[key])
                    ).toString().replace(',', '&');
                }
            };

            const instance = new tui.Grid({
                el: document.getElementById('grid'),
                data: dataSource,
                scrollX: false,
                scrollY: false,
                minBodyHeight: 30,
                rowHeaders: ['rowNum'],
                pageOptions: {
                    perPage: 10,
                    page: 1
                },
                columns: [
                    {
                        header: '제목',
                        name: 'title'
                    },
                    {
                        header: '작성자',
                        name: 'author',
                        width: 200
                    },
                    {
                        header: '작성 시간',
                        name: 'createdDate',
                        width: 200,
                        formatter: function (value) {
                            return value.value.replace(/\./g, '-').substring(0, 10);
                        }
                    }
                ]
            });
        }

        function onSearch() {
            let page = 1;
            let size = 10;

            $.get('/api/board', {page: page, size: size}, (res) => {
                let content = res.content;
                let html = '';

                $('.table tbody').empty();

                for (let i in content) {
                    let rec = content[i];

                    html += '<tr>'
                        + '<th scope="row">' + rec.id + '< /th>'
                        + '<td>' + rec.title + '</td>'
                        + '<td>' + rec.author + '</td>'
                        + '<td>' + rec.createdDate + '</td>'
                    ;
                }

                $('.table tbody').append(html);
            })
        }

    </script>
</th:block>

<div class="container" layout:fragment="content">
    <div class="row my-3">
        <h1 class="mt-5">코틀린으로 게시판 만들기</h1>
    </div>
    <div class="row">
        <form class="d-flex justify-content-end g-3 mb-4" role="search">
            <input aria-label="Search" class="form-control me-2 w-25" placeholder="Search" type="search">
            <button class="btn btn-outline-success" type="submit">Search</button>
        </form>
    </div>
    <div class="row" id="grid">
    </div>
    <div class="row">
        <div class="d-grid justify-content-md-end py-3">
            <a class="btn btn-primary btn-sm" href="/post" type="button">글쓰기</a>
        </div>
    </div>
</div>
</html>